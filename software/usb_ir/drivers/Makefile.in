include ../Make.settings

DRIVERS=libusb.so
LISTS=../list.o

ifdef DARWIN
  LDFLAGS += -undefined dynamic_lookup
endif

all: $(DRIVERS)

libusb.so: libusb.c $(LISTS) Makefile
	$(CC) $(CPPFLAGS) $(CFLAGS) $(PICFLAG) $(SHAREARG) $(LDFLAGS) $< \
		$(LISTS) -o $@ -lusb-1.0

libusbpre1.so: libusbpre1.c $(LISTS) Makefile
	$(CC) $(CPPFLAGS) $(CFLAGS) $(PICFLAG) $(SHAREARG) $(LDFLAGS) $< \
		$(LISTS) -o $@ -lusb

.PHONY: clean
clean:
	$(RM) -f *~ *.o $(DRIVERS)

.PHONY: distclean
distclean: clean
	$(RM) -f Makefile


Makefile: ../config.status Makefile.in ../Make.settings.in
	cd ..; $(SHELL) ./config.status
