
top_srcdir = @top_srcdir@
srcdir = @srcdir@

include ../Make.settings

OBJ = daemon-darwin.o

CFLAGS += -fvisibility=hidden -DIGUANAIR_EXPORTS

%.o: $(srcdir)/%.c Makefile $(top_srcdir)/iguanaIR.h
	$(CC) -c $(CPPFLAGS) $(CFLAGS) $< -o $@

launchdir = /Library/LaunchDaemons

.PHONY: all
all: Makefile $(OBJ) $(IGDAEMON_PLIST)

IGDAEMON_PLIST = net.iguanaworks.igdaemon.plist
$(IGDAEMON_PLIST): $(srcdir)/$(IGDAEMON_PLIST).in
	sed s',@''bindir@,$(bindir),' $< >$@

Makefile: ../config.status $(srcdir)/Makefile.in $(top_srcdir)/Make.settings.in
	cd .. && $(SHELL) ./config.status

.PHONY: clean distclean
clean:
	$(RM) $(OBJ)
distclean: clean
	$(RM) Makefile
	$(RM) darwin/Makefile

.PHONY: install uninstall
install: all
	$(INSTALL) -d $(DESTDIR)/$(launchdir)
	$(INSTALL_DATA) $(IGDAEMON_PLIST) $(DESTDIR)/$(launchdir)/$(IGDAEMON_PLIST)

uninstall:
	$(RM) $(DESTDIR)/$(launchdir)/$(IGDAEMON_PLIST)

