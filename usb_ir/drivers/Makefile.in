include ../Make.settings

DRIVERS=libusbpre1.so libusb.so
LISTS=../list.o

ifdef DARWIN
  LDFLAGS += -undefined dynamic_lookup
endif

all: $(DRIVERS)

libusb.so: libusb.c $(LISTS) Makefile
	$(CC) $(CPPFLAGS) $(CFLAGS) $(SHAREARG) $(LDFLAGS) -lusb-1.0 $< \
		$(LISTS) -o $@

libusbpre1.so: libusbpre1.c $(LISTS) Makefile
	$(CC) $(CPPFLAGS) $(CFLAGS) $(SHAREARG) $(LDFLAGS) -lusb $< \
		$(LISTS) -o $@

.PHONY: clean
clean:
	$(RM) -f *~ *.o $(DRIVERS)

.PHONY: distclean
distclean: clean
	$(RM) -f Makefile


Makefile: ../config.status Makefile.in ../Make.settings.in
	cd ..; $(SHELL) ./config.status
